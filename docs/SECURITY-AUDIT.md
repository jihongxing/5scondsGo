# 5SecondsGo App ç«¯å®‰å…¨æ€§ä¸ç¨³å®šæ€§å®¡è®¡æŠ¥å‘Š

## å®¡è®¡æ¦‚è¿°

æœ¬æŠ¥å‘Šå¯¹ Flutter ç§»åŠ¨ç«¯åº”ç”¨è¿›è¡Œäº†å…¨é¢çš„å®‰å…¨æ€§å’Œç¨³å®šæ€§å®¡è®¡ã€‚

---

## âœ… å·²å®ç°çš„å®‰å…¨æªæ–½

### 1. è®¤è¯ä¸æˆæƒ
- âœ… JWT Token è®¤è¯æœºåˆ¶
- âœ… Token è‡ªåŠ¨åˆ·æ–°å’Œè¿‡æœŸå¤„ç† (401 å“åº”è‡ªåŠ¨æ¸…é™¤ token)
- âœ… ç™»å½•çŠ¶æ€æŒä¹…åŒ– (SharedPreferences)
- âœ… è·¯ç”±å®ˆå« (æœªç™»å½•è‡ªåŠ¨è·³è½¬ç™»å½•é¡µ)

### 2. ç½‘ç»œé€šä¿¡
- âœ… HTTP è¯·æ±‚è¶…æ—¶è®¾ç½® (10ç§’)
- âœ… WebSocket å¿ƒè·³æ£€æµ‹ (30ç§’é—´éš”)
- âœ… WebSocket æ–­çº¿è‡ªåŠ¨é‡è¿ (æœ€å¤š5æ¬¡ï¼ŒæŒ‡æ•°é€€é¿)
- âœ… é‡è¿åè‡ªåŠ¨æ¢å¤æˆ¿é—´çŠ¶æ€

### 3. é”™è¯¯å¤„ç†
- âœ… API è¯·æ±‚å¼‚å¸¸æ•è·å’Œç”¨æˆ·æç¤º
- âœ… WebSocket é”™è¯¯å¤„ç†
- âœ… è¡¨å•éªŒè¯ (ç”¨æˆ·åéç©ºã€å¯†ç é•¿åº¦)
- âœ… éŸ³æ•ˆæ’­æ”¾é”™è¯¯é™é»˜å¤„ç†

### 4. çŠ¶æ€ç®¡ç†
- âœ… ä½¿ç”¨ Riverpod è¿›è¡ŒçŠ¶æ€ç®¡ç†
- âœ… ç»„ä»¶ dispose æ—¶æ­£ç¡®æ¸…ç†èµ„æº
- âœ… mounted æ£€æŸ¥é˜²æ­¢å†…å­˜æ³„æ¼

---

## âš ï¸ éœ€è¦æ”¹è¿›çš„é—®é¢˜

### é«˜ä¼˜å…ˆçº§

#### 1. æ•æ„Ÿæ•°æ®å­˜å‚¨ (å®‰å…¨é£é™©: ä¸­)
**é—®é¢˜**: Token ä½¿ç”¨ SharedPreferences æ˜æ–‡å­˜å‚¨
```dart
// å½“å‰å®ç°
await prefs.setString('auth_token', token);
```
**å»ºè®®**: ä½¿ç”¨ flutter_secure_storage åŠ å¯†å­˜å‚¨
```dart
// æ¨èå®ç°
final storage = FlutterSecureStorage();
await storage.write(key: 'auth_token', value: token);
```

#### 2. æœåŠ¡å™¨åœ°å€ç¡¬ç¼–ç  (é…ç½®é£é™©: ä¸­)
**é—®é¢˜**: API åœ°å€ç¡¬ç¼–ç åœ¨ä»£ç ä¸­
```dart
const String baseUrl = kIsWeb ? 'http://localhost:8080/api' : 'http://10.0.2.2:8080/api';
```
**å»ºè®®**: ä½¿ç”¨ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶
```dart
// ä½¿ç”¨ flutter_dotenv
final baseUrl = dotenv.env['API_BASE_URL'] ?? 'http://localhost:8080/api';
```

#### 3. ç¼ºå°‘ SSL è¯ä¹¦æ ¡éªŒ (å®‰å…¨é£é™©: é«˜ - ç”Ÿäº§ç¯å¢ƒ)
**é—®é¢˜**: æœªé…ç½® HTTPS è¯ä¹¦å›ºå®š
**å»ºè®®**: ç”Ÿäº§ç¯å¢ƒå¯ç”¨ SSL Pinning
```dart
// æ·»åŠ è¯ä¹¦å›ºå®š
(dio.httpClientAdapter as DefaultHttpClientAdapter).onHttpClientCreate = (client) {
  client.badCertificateCallback = (cert, host, port) {
    return cert.pem == expectedCertPem;
  };
  return client;
};
```

### ä¸­ä¼˜å…ˆçº§

#### 4. è¾“å…¥éªŒè¯ä¸å®Œæ•´ (å®‰å…¨é£é™©: ä½)
**é—®é¢˜**: éƒ¨åˆ†è¾“å…¥ç¼ºå°‘é•¿åº¦é™åˆ¶å’Œæ ¼å¼éªŒè¯
```dart
// å½“å‰ï¼šåªæ£€æŸ¥éç©ºå’Œæœ€å°é•¿åº¦
validator: (value) {
  if (value == null || value.isEmpty) return 'è¯·è¾“å…¥ç”¨æˆ·å';
  return null;
}
```
**å»ºè®®**: æ·»åŠ å®Œæ•´éªŒè¯
```dart
validator: (value) {
  if (value == null || value.isEmpty) return 'è¯·è¾“å…¥ç”¨æˆ·å';
  if (value.length < 3) return 'ç”¨æˆ·åè‡³å°‘3ä¸ªå­—ç¬¦';
  if (value.length > 20) return 'ç”¨æˆ·åæœ€å¤š20ä¸ªå­—ç¬¦';
  if (!RegExp(r'^[a-zA-Z0-9_]+$').hasMatch(value)) return 'åªèƒ½åŒ…å«å­—æ¯æ•°å­—ä¸‹åˆ’çº¿';
  return null;
}
```

#### 5. æ—¥å¿—è¾“å‡º (å®‰å…¨é£é™©: ä½)
**é—®é¢˜**: ç”Ÿäº§ç¯å¢ƒå¯èƒ½è¾“å‡ºæ•æ„Ÿæ—¥å¿—
**å»ºè®®**: æ·»åŠ æ—¥å¿—çº§åˆ«æ§åˆ¶
```dart
if (kDebugMode) {
  print('Debug: $message');
}
```

#### 6. WebSocket æ¶ˆæ¯éªŒè¯ (ç¨³å®šæ€§é£é™©: ä½)
**é—®é¢˜**: æ¶ˆæ¯è§£ææ—¶ç±»å‹è½¬æ¢å¯èƒ½å¤±è´¥
```dart
// å½“å‰å®ç°
final message = jsonDecode(data as String) as Map<String, dynamic>;
```
**å»ºè®®**: æ·»åŠ æ›´å¥å£®çš„è§£æ
```dart
try {
  final decoded = jsonDecode(data as String);
  if (decoded is! Map<String, dynamic>) return;
  // å¤„ç†æ¶ˆæ¯
} catch (e) {
  debugPrint('Invalid message format: $e');
}
```

### ä½ä¼˜å…ˆçº§

#### 7. ç¼ºå°‘è¯·æ±‚é‡è¯•æœºåˆ¶
**å»ºè®®**: æ·»åŠ  dio é‡è¯•æ‹¦æˆªå™¨
```dart
dio.interceptors.add(RetryInterceptor(
  dio: dio,
  retries: 3,
  retryDelays: [1.seconds, 2.seconds, 3.seconds],
));
```

#### 8. ç¼ºå°‘ç½‘ç»œçŠ¶æ€ç›‘å¬
**å»ºè®®**: æ·»åŠ  connectivity_plus ç›‘å¬ç½‘ç»œå˜åŒ–
```dart
Connectivity().onConnectivityChanged.listen((result) {
  if (result != ConnectivityResult.none) {
    // ç½‘ç»œæ¢å¤ï¼Œå°è¯•é‡è¿
  }
});
```

---

## âœ… ç¨³å®šæ€§è¯„ä¼°

### å·²å®ç°çš„ç¨³å®šæ€§æªæ–½

| åŠŸèƒ½ | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|
| å¼‚å¸¸æ•è· | âœ… | API å’Œ WebSocket é”™è¯¯éƒ½æœ‰å¤„ç† |
| è‡ªåŠ¨é‡è¿ | âœ… | WebSocket æ–­çº¿è‡ªåŠ¨é‡è¿ |
| çŠ¶æ€æ¢å¤ | âœ… | é‡è¿åè‡ªåŠ¨æ¢å¤æˆ¿é—´çŠ¶æ€ |
| èµ„æºæ¸…ç† | âœ… | dispose æ—¶æ­£ç¡®æ¸…ç†è®¢é˜…å’Œå®šæ—¶å™¨ |
| å†…å­˜æ³„æ¼é˜²æŠ¤ | âœ… | mounted æ£€æŸ¥ |
| åŠ è½½çŠ¶æ€ | âœ… | æŒ‰é’®ç¦ç”¨é˜²æ­¢é‡å¤æäº¤ |
| ä¸‹æ‹‰åˆ·æ–° | âœ… | é’±åŒ…ç­‰é¡µé¢æ”¯æŒåˆ·æ–° |

### æ½œåœ¨ç¨³å®šæ€§é—®é¢˜

| é—®é¢˜ | é£é™©ç­‰çº§ | è¯´æ˜ |
|------|----------|------|
| å¤§é‡æ¶ˆæ¯å †ç§¯ | ä½ | èŠå¤©æ¶ˆæ¯é™åˆ¶100æ¡ï¼Œè¡¨æƒ…é™åˆ¶5ä¸ª |
| å®šæ—¶å™¨æ³„æ¼ | ä½ | å·²åœ¨ dispose ä¸­æ¸…ç† |
| å¹¶å‘çŠ¶æ€æ›´æ–° | ä½ | Riverpod å¤„ç†å¾—å½“ |

---

## ğŸ“‹ æ”¹è¿›å»ºè®®æ¸…å•

### å¿…é¡»ä¿®å¤ (ç”Ÿäº§ç¯å¢ƒå‰)

1. [x] ä½¿ç”¨ flutter_secure_storage å­˜å‚¨ Token âœ… å·²ä¿®å¤
2. [x] é…ç½®ç”Ÿäº§ç¯å¢ƒ HTTPS âœ… å·²æ”¯æŒï¼ˆé€šè¿‡ .env.productionï¼‰
3. [x] ç§»é™¤ç¡¬ç¼–ç çš„æœåŠ¡å™¨åœ°å€ âœ… å·²ä¿®å¤ï¼ˆä½¿ç”¨ç¯å¢ƒå˜é‡ï¼‰

### å»ºè®®æ”¹è¿›

4. [ ] æ·»åŠ å®Œæ•´çš„è¾“å…¥éªŒè¯
5. [x] æ·»åŠ è¯·æ±‚é‡è¯•æœºåˆ¶ âœ… å·²ä¿®å¤ï¼ˆdio_smart_retryï¼‰
6. [ ] æ·»åŠ ç½‘ç»œçŠ¶æ€ç›‘å¬
7. [ ] æ·»åŠ æ—¥å¿—çº§åˆ«æ§åˆ¶
8. [ ] æ·»åŠ å´©æºƒä¸ŠæŠ¥ (å¦‚ Sentry)

### å¯é€‰ä¼˜åŒ–

9. [ ] æ·»åŠ  SSL Pinning
10. [ ] æ·»åŠ è¯·æ±‚ç­¾å
11. [ ] æ·»åŠ è®¾å¤‡æŒ‡çº¹

---

## æ€»ä½“è¯„ä¼°

| ç»´åº¦ | è¯„åˆ† | è¯´æ˜ |
|------|------|------|
| å®‰å…¨æ€§ | 7/10 | åŸºç¡€å®‰å…¨æªæ–½å®Œå–„ï¼Œç”Ÿäº§ç¯å¢ƒéœ€åŠ å¼º |
| ç¨³å®šæ€§ | 8/10 | é”™è¯¯å¤„ç†å’Œé‡è¿æœºåˆ¶è‰¯å¥½ |
| ä»£ç è´¨é‡ | 8/10 | ç»“æ„æ¸…æ™°ï¼ŒçŠ¶æ€ç®¡ç†è§„èŒƒ |
| å¯ç»´æŠ¤æ€§ | 8/10 | æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºæ‰©å±• |

**ç»“è®º**: åº”ç”¨æ•´ä½“å¥å£®æ€§è‰¯å¥½ï¼Œé€‚åˆæµ‹è¯•å’Œå†…éƒ¨ä½¿ç”¨ã€‚ç”Ÿäº§ç¯å¢ƒå‘å¸ƒå‰éœ€è¦å®Œæˆ"å¿…é¡»ä¿®å¤"é¡¹ç›®ã€‚

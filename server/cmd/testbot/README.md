# 5SecondsGo 测试机器人

自动化测试工具，用于模拟多人游戏场景。

## 功能

1. 自动创建房主账号
2. 为房主充值
3. 创建多个玩家账号（通过房主邀请码注册）
4. 为所有玩家充值
5. 创建游戏房间
6. 玩家自动加入房间并设置自动准备
7. 通过 WebSocket 监控游戏进行指定轮数
8. 分析游戏后的资金情况，验证资金守恒

## 编译

```bash
cd server
go build -o testbot.exe ./cmd/testbot
```

## 使用

```bash
# 使用默认参数运行
./testbot.exe

# 自定义参数
./testbot.exe -url http://localhost:8080 -players 5 -rounds 5 -bet 20 -balance 2000
```

## 参数说明

| 参数 | 默认值 | 说明 |
|------|--------|------|
| `-url` | `http://localhost:8080` | 服务器地址 |
| `-admin` | `admin` | 管理员用户名 |
| `-admin-pass` | `admin123` | 管理员密码 |
| `-players` | `3` | 玩家数量 |
| `-rounds` | `3` | 游戏轮数 |
| `-bet` | `10` | 下注金额 |
| `-balance` | `1000` | 每个玩家的初始余额 |

## 输出示例

```
========================================
5SecondsGo 测试机器人
========================================
服务器: http://localhost:8080
玩家数量: 3
游戏轮数: 3
下注金额: 10
初始余额: 1000
========================================

[步骤 1] 管理员登录...
✓ 管理员登录成功

[步骤 2] 创建房主账号...
✓ 房主创建成功: testowner_1702300000 (ID: 5)

[步骤 3] 为房主充值...
✓ 房主充值成功: 1000

[步骤 4] 创建玩家账号...
✓ 玩家创建成功: testplayer_1702300000_1 (ID: 6)
✓ 玩家创建成功: testplayer_1702300000_2 (ID: 7)
✓ 玩家创建成功: testplayer_1702300000_3 (ID: 8)

[步骤 5] 为玩家充值...
✓ 所有玩家充值成功，每人: 1000

[步骤 6] 创建游戏房间...
✓ 房间创建成功: ABC123 (ID: 1)

[步骤 7] 玩家加入房间...
  玩家 testplayer_1702300000_1 已连接 WebSocket
  玩家 testplayer_1702300000_2 已连接 WebSocket
  玩家 testplayer_1702300000_3 已连接 WebSocket
✓ 所有玩家已加入房间

[步骤 8] 开始游戏...
  设置所有玩家自动准备...
  等待游戏进行...
  目标轮数: 3
  第 1 轮结束 - 赢家: testplayer_1702300000_2, 奖金: 28.50
  已完成 1/3 轮
  第 2 轮结束 - 赢家: testplayer_1702300000_1, 奖金: 28.50
  已完成 2/3 轮
  第 3 轮结束 - 赢家: testplayer_1702300000_3, 奖金: 28.50
✓ 游戏完成!

[步骤 9] 分析游戏结果...

========================================
游戏结果分析
========================================

[玩家余额]
  testplayer_1702300000_1: 1008.50 (初始: 1000, 变化: +8.50)
  testplayer_1702300000_2: 1008.50 (初始: 1000, 变化: +8.50)
  testplayer_1702300000_3: 1008.50 (初始: 1000, 变化: +8.50)

[房主余额]
  testowner_1702300000: 1002.70

[游戏统计]
  总轮数: 3
  testplayer_1702300000_1: 获胜 1 次
  testplayer_1702300000_2: 获胜 1 次
  testplayer_1702300000_3: 获胜 1 次

[资金分析]
  总下注金额: 90
  房主抽成 (3%): 2.70
  平台抽成 (2%): 1.80
  玩家总余额变化: -4.50

[资金守恒验证]
  预期玩家总损失 (抽成): -4.50
  实际玩家总损失: -4.50
  ✓ 资金守恒验证通过!

========================================
测试完成
========================================
```

## 注意事项

1. 确保服务器已启动并可访问
2. 确保管理员账号存在且密码正确
3. 每次运行会创建新的房主和玩家账号（带时间戳）
4. 游戏需要等待状态机自动推进，可能需要一些时间
